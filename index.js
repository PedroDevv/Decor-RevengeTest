(function(b,i,t,C,c,T,u,f,S,F){"use strict";const A=function(e,a){return c.storage.useCustomConstants&&e?e:a},K=A(c.storage.clientId,"1096966363416899624"),Y=A(c.storage.baseUrl,"https://decor.fieryflames.dev"),q=A(c.storage.cdnUrl,"https://decorcdn.fieryflames.dev"),X="https://discord.gg/dXp2SdxDcP",h=Y+"/api";let N;const v=function(e,a){return fetch(e,{...a,headers:{...a?.headers,Authorization:`Bearer ${c.storage.token}`}}).then(function(n){return n.ok?n:Promise.reject(n)})},J=async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"default";return N=new Map(Object.entries(await fetch(h+"/users",{cache:e}).then(function(a){return a.json()})))},Q=async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"@me";return v(h+`/users/${e}/decorations`).then(function(a){return a.json()})},Z=async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"@me";return v(h+`/users/${e}/decoration`).then(function(a){return a.json()})},U=async function(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"@me";const n=new FormData;return e&&Object.hasOwn(e,"hash")?(e=e,n.append("hash",e.hash)):e?e&&Object.hasOwn(e,"uri")&&(e=e,n.append("image",{uri:e.uri,type:e.fileType,name:e.fileName}),n.append("alt",e.alt)):n.append("hash",null),v(h+`/users/${a}/decoration`,{method:"PUT",body:n}).then(function(r){return e&&Object.hasOwn(e,"uri")?r.json():r.text()})},ee=async function(e){await v(h+`/decorations/${e}`,{method:"DELETE"})},te=async function(){return fetch(h+"/decorations/presets").then(function(e){return e.json()})},{pushModal:ae,popModal:L}=i.findByProps("pushModal"),ne=i.findByName("OAuth2AuthorizeModal");function re(){return ae({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:ne,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:K,redirectUri:h+"/authorize",scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(e){let{location:a}=e;const n=new URL(a);n.searchParams.append("client","vendetta");const r=await fetch(n);r?.ok?c.storage.token=await r.text():L("oauth2-authorize")},dismissOAuthModal:function(){return L("oauth2-authorize")}},closable:!0}})}function E(e){return{asset:`decor_${e.animated?"a_":""}${e.hash}`,skuId:"0"}}const ie=t.ReactNative.NativeModules.DCDFileManager??t.ReactNative.NativeModules.RTNFileManager;async function oe(e){return e.startsWith("file://")&&(e=e.slice(7)),ie.readFile(e,"base64")}const{View:_}=f.General,se=i.findByName("HeaderAvatar"),{AvatarColumn:ce}=i.findByProps("AvatarColumn"),le=i.findByStoreName("UserStore"),O=t.stylesheet.createThemedStyleSheet({headerAvatarContainer:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:S.semanticColors.BACKGROUND_FLOATING,width:208,height:208,borderRadius:4},container:{flexDirection:"row",width:"100%",justifyContent:"center",alignItems:"center",paddingHorizontal:16,paddingTop:16}});function x(e){let{decorationData:a}=e;const n=a||null;return React.createElement(_,{style:O.container},React.createElement(_,{style:O.headerAvatarContainer},React.createElement(se,{user:le.getCurrentUser(),pendingAvatarDecoration:n,size:"editAvatarDecoration",decorationStyle:{margin:-12}})),React.createElement(ce,{pendingAvatarDecoration:n}))}const de=i.findByName("create"),{subscribeWithSelector:ue}=i.findByProps("subscribeWithSelector"),fe=i.findByStoreName("UserStore"),y=de(ue(function(e,a){return{decorations:[],selectedDecoration:null,fetched:!1,fetch:async function(){return e({decorations:await Q(),selectedDecoration:await Z(),fetched:!0})},create:async function(n){const r=await U(n);e({decorations:[...a().decorations,r]})},delete:async function(n){const r=typeof n=="object"?n.hash:n;await ee(r);const{selectedDecoration:o,decorations:l}=a();let s={decorations:l.filter(function(d){return d.hash!==r})};o?.hash===r&&(s.selectedDecoration=null),e(s)},select:async function(n){e({selectedDecoration:n})},clear:function(){return e({decorations:[],selectedDecoration:null,fetched:!1})}}})),he=y.subscribe(function(e){return[e.selectedDecoration,e.fetched]},t.lodash.debounce(function(e,a){let[n,r]=e,[o,l]=a;if(r!==l||n?.hash===o?.hash)return;U(n);const s=fe.getCurrentUser();s.avatarDecoration=n?E(n):null,t.FluxDispatcher.dispatch({type:"USER_UPDATE",user:s})},1e3)),{FormIcon:ye}=f.Forms;function p(e){let{source:a}=e;return React.createElement(ye,{source:a,style:{opacity:1}})}const{ScrollView:pe,View:k}=t.ReactNative,{FormSection:ge,FormRow:Re,FormArrow:ve,FormInput:Ee,FormDivider:De,FormHint:w}=f.Forms,{popModal:be}=i.findByProps("pushModal"),{launchImageLibrary:Ce}=i.findByProps("launchImageLibrary"),{useSafeAreaInsets:Se}=i.findByProps("useSafeAreaInsets");function Ae(){const[e,a]=t.React.useState(null),[n,r]=t.React.useState(""),o=Se(),l=y(function(s){return s.create});return t.React.createElement(pe,{contentContainerStyle:{flexGrow:1}},t.React.createElement(k,{style:{flex:1}},t.React.createElement(x,{decorationData:e?.uri}),t.React.createElement(ge,null,t.React.createElement(Re,{label:"Select Image",leading:t.React.createElement(p,{source:u.getAssetIDByName("ic_image")}),trailing:ve,onPress:function(){Ce({mediaType:"photo",maxWidth:768,maxHeight:768},function(s){if(!s||s.didCancel){a(null);return}const d=s.assets[0];d&&a(d)})}}),t.React.createElement(De,null),t.React.createElement(Ee,{value:n,onChange:r,placeholder:"Apeture Science Logo",title:"Name / Alt Text"})),t.React.createElement(w,null,"Avatar decorations are 1.2 times the size of a avatar."),t.React.createElement(w,null,"Your decoration will be reviewed before you can use it. If approved, it will be set as your selected decoration."),t.ReactNative.Platform.OS!=="ios"&&t.React.createElement(w,null,"Animated PNGs will not animate in the preview above on your platform.")),t.React.createElement(k,{style:{justifyContent:"flex-end",paddingHorizontal:16,paddingBottom:o.bottom}},t.React.createElement(f.Button,{text:"Create Decoration",color:"brand",size:"medium",onPress:async function(){if(!e)return;let s;t.ReactNative.Platform.OS==="ios"?s="data:"+e.type+";base64,"+await oe(e.uri):s=e.uri,await l({uri:s,fileName:e.fileName,fileType:e.type,alt:n}),be("create-decoration")},disabled:!e||!n})))}const Ne=i.findByName("Navigator")??i.findByProps("Navigator")?.Navigator,we=i.findByProps("getRenderCloseButton")?.getRenderCloseButton??i.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,{popModal:me}=i.findByProps("pushModal");function Pe(){return React.createElement(Ne,{initialRouteName:"CREATE_DECORATION",screens:{CREATE_DECORATION:{headerLeft:we(function(){return me("create-decoration")}),render:Ae,title:"Create Decoration"}}})}const{pushModal:$e}=i.findByProps("pushModal");function Ie(){return $e({key:"create-decoration",modal:{key:"create-decoration",modal:Pe,animation:"slide-up",shouldPersistUnderModals:!1,closable:!0}})}function M(){return F.useProxy(c.storage),!!c.storage.token}const{View:z,TouchableOpacity:Be}=t.ReactNative,{triggerHapticFeedback:Te,HapticFeedbackTypes:Fe}=i.findByProps("triggerHapticFeedback"),D=t.stylesheet.createThemedStyleSheet({container:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:S.semanticColors.BACKGROUND_FLOATING,width:72,height:72,borderRadius:4},inner:{display:"flex",justifyContent:"space-evenly",alignItems:"center"},selected:{borderWidth:2,borderColor:S.semanticColors.BUTTON_OUTLINE_BRAND_BORDER_ACTIVE},disabled:{opacity:.5}}),H=function(e){Te(Fe.IMPACT_LIGHT),e()};function j(e){let{onPress:a=void 0,onLongPress:n=void 0,disabled:r=void 0,lookDisabled:o=void 0,selected:l=!1,children:s}=e;return React.createElement(Be,{onPress:a?function(){return H(a)}:void 0,onLongPress:n?function(){return H(n)}:void 0,disabled:r},React.createElement(z,{style:[D.container,l?D.selected:null]},React.createElement(z,{style:[D.inner,(r||o)&&D.disabled]},s)))}const{TextStyleSheet:Ue,Text:Le}=i.findByProps("TextStyleSheet");function m(e){let{source:a,label:n,onPress:r,disabled:o,selected:l=!1}=e;return React.createElement(j,{onPress:r,disabled:o,selected:l},React.createElement(p,{source:a}),React.createElement(Le,{style:[Ue["text-sm/medium"]]},n))}const _e=i.findByProps("getAvatarDecorationURL","default"),{showSimpleActionSheet:Oe}=i.findByProps("showSimpleActionSheet"),{hideActionSheet:xe}=i.findByProps("openLazy","hideActionSheet"),ke=i.findByStoreName("UserStore"),{Image:Me}=t.ReactNative;function ze(e){return Oe({key:"DecorationActionSheet",header:{title:e.alt??"Decoration",icon:React.createElement(Me,{source:{uri:_e.getAvatarDecorationURL({avatarDecoration:E(e)})},style:{width:24,height:24,marginRight:8}}),onClose:function(){return xe()}},options:[...e.authorId===ke.getCurrentUser().id?[{icon:u.getAssetIDByName("ic_message_delete"),label:"Delete",isDestructive:!0,onPress:function(){return T.showConfirmationAlert({title:"Delete Decoration",content:`Are you sure you want to delete ${e.alt??"this decoration"}?`,confirmText:"Delete",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){return t.ReactNative.unstable_batchedUpdates(function(){return y.getState().delete(e)})}})}}]:[]]})}const He=i.findByName("CutoutableAvatarDecoration");function V(e){let{decoration:a,onPress:n=void 0,selectable:r=void 0,disabled:o=void 0}=e;const{selectedDecoration:l,select:s}=y(function(d){return{selectedDecoration:d.selectedDecoration,select:d.select}});return r??=a.reviewed===null||a.reviewed===!0,n??=function(){return s(a)},React.createElement(j,{onPress:r?n:void 0,onLongPress:function(){return ze(a)},selected:l?.hash===a.hash,disabled:o,lookDisabled:!r},React.createElement(He,{avatarDecoration:E(a),size:56,animate:!1}))}const{FormTitle:je}=f.Forms,{View:P,FlatList:Ve}=t.ReactNative,{TextStyleSheet:Ge,Text:We}=i.findByProps("TextStyleSheet");function Ke(e){let{preset:a}=e;const n=y(function(o){return o.select}),r=t.NavigationNative.useNavigation();return React.createElement(P,null,React.createElement(P,null,React.createElement(je,{title:a.name}),a.description&&React.createElement(We,{style:[Ge["text-sm/medium"],{paddingHorizontal:16,paddingBottom:8}]},a.description)),React.createElement(Ve,{horizontal:!0,showsHorizontalScrollIndicator:!1,data:a.decorations,renderItem:function(o){let{item:l}=o;return React.createElement(V,{decoration:l,onPress:function(){n(l),r.pop()}})},ItemSeparatorComponent:function(){return React.createElement(P,{style:{width:4}})},snapToInterval:74,decelerationRate:"fast",contentContainerStyle:{paddingHorizontal:8}}))}const{FlatList:Ye}=t.ReactNative;function qe(){const[e,a]=t.React.useState([]);return t.React.useEffect(function(){te().then(function(n){return a(n)})},[]),t.React.createElement(Ye,{data:e,renderItem:function(n){let{item:r}=n;return t.React.createElement(Ke,{preset:r})}})}const{FlatList:Xe,View:$,ActivityIndicator:Je}=t.ReactNative,{FormTitle:Qe}=f.Forms;function Ze(){const[e,a]=t.React.useState(!1),{decorations:n,selectedDecoration:r,fetch:o,clear:l,select:s}=y(),d=M();t.React.useEffect(function(){d?(o().then(function(){return a(!1)}).catch(function(W){return a(null)}),a(!0)):(l(),a(!1))},[d]);const yt=t.NavigationNative.useNavigation();return t.React.createElement(t.React.Fragment,null,t.React.createElement(x,{decorationData:r?E(r):null}),t.React.createElement(Qe,{title:"Decorations",icon:e?t.React.createElement(Je,null):e===null?t.React.createElement(p,{source:u.getAssetIDByName("ic_warning_24px")}):void 0}),t.React.createElement(Xe,{horizontal:!0,showsHorizontalScrollIndicator:!1,data:n,renderItem:function(W){let{item:pt}=W;return t.React.createElement(V,{decoration:pt,disabled:!d||e===null})},snapToInterval:74,decelerationRate:"fast",ItemSeparatorComponent:function(){return t.React.createElement($,{style:{width:4}})},ListHeaderComponent:function(){return t.React.createElement(m,{source:u.getAssetIDByName("img_none"),label:"None",onPress:function(){s(null)},disabled:!d||e===null,selected:!r})},ListHeaderComponentStyle:{paddingRight:n.length===0?2:4},ListFooterComponent:function(){return t.React.createElement($,{style:{flexDirection:"row"}},t.React.createElement(m,{source:u.getAssetIDByName("smile"),label:"Presets",onPress:function(){yt.push("VendettaCustomPage",{title:"Presets",render:qe})},selected:r&&r.presetId!==null,disabled:!d||e===null}),t.React.createElement($,{style:{width:4}}),t.React.createElement(m,{source:u.getAssetIDByName("ic_add_24px"),label:"New..",onPress:Ie,disabled:!d||e===null}))},ListFooterComponentStyle:{paddingLeft:n.length===0?2:4},contentContainerStyle:{paddingHorizontal:8}}))}const{Messages:g}=i.findByProps("Messages"),{triggerHapticFeedback:et,HapticFeedbackTypes:tt}=i.findByProps("triggerHapticFeedback"),{ScrollView:gt,View:G}=t.ReactNative,{FormSection:I,FormRow:B,FormArrow:at,FormSwitchRow:nt,FormCTAButton:rt,FormDivider:it,FormInput:ot}=f.Forms,st=f.HelpMessage,{KeyboardAwareScrollView:ct}=i.findByProps("KeyboardAwareScrollView");function lt(){F.useProxy(c.storage);const e=M();return t.React.createElement(ct,null,!e&&t.React.createElement(G,{style:{padding:8}},t.React.createElement(st,{messageType:0},"You need to Authorize with Decor before you can get custom decorations.")),t.React.createElement(Ze,null),!e&&t.React.createElement(I,null,t.React.createElement(B,{label:"Authorize with Decor",leading:t.React.createElement(p,{source:u.getAssetIDByName("ic_link_24px")}),trailing:at,onPress:re})),t.React.createElement(I,null,t.React.createElement(B,{label:"Discord Server",leading:t.React.createElement(p,{source:u.getAssetIDByName("Discord")}),trailing:B.Arrow,onPress:function(){return t.url.openDeeplink(X)},onLongPress:function(){et(tt.IMPACT_LIGHT),c.storage.developerMode=!c.storage.developerMode}})),e&&t.React.createElement(rt,{color:"danger",label:g.LOGOUT,onPress:function(){return T.showConfirmationAlert({title:g.LOGOUT,content:g.USER_SETTINGS_CONFIRM_LOGOUT,confirmText:g.LOGOUT,confirmColor:"red",cancelText:g.CANCEL,onConfirm:function(){return c.storage.token=void 0}})}}),c.storage.developerMode&&t.React.createElement(I,{title:"Developer Settings"},t.React.createElement(nt,{label:"Use Custom Constants",subLabel:"Override constants with custom values.",leading:t.React.createElement(p,{source:u.getAssetIDByName("ic_link_24px")}),value:c.storage.useCustomConstants,onValueChange:function(a){return c.storage.useCustomConstants=a}}),[{title:"Client ID",placeholder:"012345678910",key:"clientId"},{title:"Base URL",placeholder:"http://example.com",key:"baseUrl"},{title:"CDN URL",placeholder:"http://example.com",key:"cdnUrl"}].map(function(a){let{title:n,placeholder:r,key:o}=a;return t.React.createElement(t.React.Fragment,null,t.React.createElement(it,null),t.React.createElement(ot,{title:n,placeholder:r,value:c.storage[o],onChange:function(l){return c.storage[o]=l},disabled:!c.storage.useCustomConstants}))})),t.React.createElement(G,{style:{height:40}}))}const dt=i.findByStoreName("UserStore"),ut=i.findByProps("getAvatarDecorationURL","default"),ft=i.findByProps("isAnimatedAvatarDecoration");let R=[];var ht={onLoad:async function(){R.push(he),R.push(C.after("getUser",dt,function(e,a){a&&!a.avatarDecoration?.asset?.startsWith("decor_")&&N?.has(a.id)&&(a.avatarDecoration={asset:`decor_${N?.get(a.id)}`,skuId:"0"})})),R.push(C.after("getAvatarDecorationURL",ut,function(e,a){let[{avatarDecoration:n,canAnimate:r}]=e;if(n?.asset?.startsWith("decor")){const o=n.asset.split("_").slice(1);return!r&&o[0]==="a"&&o.shift(),q+`/${o.join("_")}.png`}else if(n?.asset?.startsWith("file://"))return n.asset})),R.push(C.after("isAnimatedAvatarDecoration",ft,function(e,a){let[n]=e;if(t.ReactNative.Platform.OS==="ios"&&n?.asset?.startsWith("file://"))return!0})),c.storage.developerMode??=!1,J()},onUnload:function(){R.forEach(function(e){return e()})},settings:lt};return b.default=ht,Object.defineProperty(b,"__esModule",{value:!0}),b})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.ui.alerts,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.storage);
