(function(C,i,t,b,c,U,d,f,A,F){"use strict";const S=function(e,a){return c.storage.useCustomConstants&&e?e:a},Y=S(c.storage.clientId,"1096966363416899624"),q=S(c.storage.baseUrl,"https://decor.fieryflames.dev"),X=S(c.storage.cdnUrl,"https://decorcdn.fieryflames.dev"),J="https://discord.gg/dXp2SdxDcP",h=q+"/api";let m;const v=function(e,a){return fetch(e,{...a,headers:{...a?.headers,Authorization:`Bearer ${c.storage.token}`}}).then(function(n){return n.ok?n:Promise.reject(n)})},Q=async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"default";return m=new Map(Object.entries(await fetch(h+"/users",{cache:e}).then(function(a){return a.json()})))},Z=async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"@me";return v(h+`/users/${e}/decorations`).then(function(a){return a.json()})},ee=async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"@me";return v(h+`/users/${e}/decoration`).then(function(a){return a.json()})},L=async function(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"@me";const n=new FormData;return e&&Object.hasOwn(e,"hash")?(e=e,n.append("hash",e.hash)):e?e&&Object.hasOwn(e,"uri")&&(e=e,n.append("image",{uri:e.uri,type:e.fileType,name:e.fileName}),n.append("alt",e.alt)):n.append("hash",null),v(h+`/users/${a}/decoration`,{method:"PUT",body:n}).then(function(r){return e&&Object.hasOwn(e,"uri")?r.json():r.text()})},te=async function(e){await v(h+`/decorations/${e}`,{method:"DELETE"})},ae=async function(){return fetch(h+"/decorations/presets").then(function(e){return e.json()})},{pushModal:ne,popModal:_}=i.findByProps("pushModal"),re=i.findByName("OAuth2AuthorizeModal");function ie(){return ne({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:re,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:Y,redirectUri:h+"/authorize",scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(e){let{location:a}=e;const n=new URL(a);n.searchParams.append("client","vendetta");const r=await fetch(n);r?.ok?c.storage.token=await r.text():_("oauth2-authorize")},dismissOAuthModal:function(){return _("oauth2-authorize")}},closable:!0}})}function E(e){return`decor_${e.animated?"a_":""}${e.hash}`}const oe=t.ReactNative.NativeModules.DCDFileManager??t.ReactNative.NativeModules.RTNFileManager;async function se(e){return e.startsWith("file://")&&(e=e.slice(7)),oe.readFile(e,"base64")}const{View:x}=f.General,ce=i.findByName("HeaderAvatar"),{AvatarColumn:le}=i.findByProps("AvatarColumn"),ue=i.findByStoreName("UserStore"),O=t.stylesheet.createThemedStyleSheet({headerAvatarContainer:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:A.semanticColors.BACKGROUND_FLOATING,width:208,height:208,borderRadius:4},container:{flexDirection:"row",width:"100%",justifyContent:"center",alignItems:"center",paddingHorizontal:16,paddingTop:16}});function k(e){let{decorationData:a}=e;const n=a?{hash:a}:null;return React.createElement(x,{style:O.container},React.createElement(x,{style:O.headerAvatarContainer},React.createElement(ce,{user:ue.getCurrentUser(),pendingAvatarDecoration:n,size:"editAvatarDecoration",decorationStyle:{margin:-12}})),React.createElement(le,{pendingAvatarDecoration:n}))}const de=i.findByName("create"),{subscribeWithSelector:fe}=i.findByProps("subscribeWithSelector"),he=i.findByStoreName("UserStore"),p=de(fe(function(e,a){return{decorations:[],selectedDecoration:null,fetched:!1,fetch:async function(){return e({decorations:await Z(),selectedDecoration:await ee(),fetched:!0})},create:async function(n){const r=await L(n);e({decorations:[...a().decorations,r]})},delete:async function(n){const r=typeof n=="object"?n.hash:n;await te(r);const{selectedDecoration:o,decorations:l}=a();let s={decorations:l.filter(function(u){return u.hash!==r})};o?.hash===r&&(s.selectedDecoration=null),e(s)},select:async function(n){e({selectedDecoration:n})},clear:function(){return e({decorations:[],selectedDecoration:null,fetched:!1})}}})),pe=p.subscribe(function(e){return[e.selectedDecoration,e.fetched]},t.lodash.debounce(function(e,a){let[n,r]=e,[o,l]=a;if(r!==l||n?.hash===o?.hash)return;L(n);const s=he.getCurrentUser();s.avatarDecoration=n?E(n):null,t.FluxDispatcher.dispatch({type:"USER_UPDATE",user:s})},1e3)),{FormIcon:ye}=f.Forms;function y(e){let{source:a}=e;return React.createElement(ye,{source:a,style:{opacity:1}})}const{ScrollView:ge,View:M}=t.ReactNative,{FormSection:Re,FormRow:ve,FormArrow:Ee,FormInput:De,FormDivider:Ce,FormHint:w}=f.Forms,{popModal:be}=i.findByProps("pushModal"),{launchImageLibrary:Ae}=i.findByProps("launchImageLibrary"),{useSafeAreaInsets:Se}=i.findByProps("useSafeAreaInsets");function me(){const[e,a]=t.React.useState(null),[n,r]=t.React.useState(""),o=Se(),l=p(function(s){return s.create});return t.React.createElement(ge,{contentContainerStyle:{flexGrow:1}},t.React.createElement(M,{style:{flex:1}},t.React.createElement(k,{decorationData:e?.uri}),t.React.createElement(Re,null,t.React.createElement(ve,{label:"Select Image",leading:t.React.createElement(y,{source:d.getAssetIDByName("ic_image")}),trailing:Ee,onPress:function(){Ae({mediaType:"photo",maxWidth:768,maxHeight:768},function(s){if(!s||s.didCancel){a(null);return}const u=s.assets[0];u&&a(u)})}}),t.React.createElement(Ce,null),t.React.createElement(De,{value:n,onChange:r,placeholder:"Apeture Science Logo",title:"Name / Alt Text"})),t.React.createElement(w,null,"Avatar decorations are 1.2 times the size of a avatar."),t.React.createElement(w,null,"Your decoration will be reviewed before you can use it. If approved, it will be set as your selected decoration."),t.ReactNative.Platform.OS!=="ios"&&t.React.createElement(w,null,"Animated PNGs will not animate in the preview above on your platform.")),t.React.createElement(M,{style:{justifyContent:"flex-end",paddingHorizontal:16,paddingBottom:o.bottom}},t.React.createElement(f.Button,{text:"Create Decoration",color:"brand",size:"medium",onPress:async function(){if(!e)return;let s;t.ReactNative.Platform.OS==="ios"?s="data:"+e.type+";base64,"+await se(e.uri):s=e.uri,await l({uri:s,fileName:e.fileName,fileType:e.type,alt:n}),be("create-decoration")},disabled:!e||!n})))}const{default:we,getRenderCloseButton:Ne}=i.findByProps("getRenderCloseButton"),{popModal:Pe}=i.findByProps("pushModal");function $e(){return React.createElement(we,{initialRouteName:"CREATE_DECORATION",screens:{CREATE_DECORATION:{headerLeft:Ne(function(){return Pe("create-decoration")}),render:me,title:"Create Decoration"}}})}const{pushModal:Ie}=i.findByProps("pushModal");function Te(){return Ie({key:"create-decoration",modal:{key:"create-decoration",modal:$e,animation:"slide-up",shouldPersistUnderModals:!1,closable:!0}})}function z(){return F.useProxy(c.storage),!!c.storage.token}const{View:H,TouchableOpacity:Be}=t.ReactNative,{triggerHapticFeedback:Ue,HapticFeedbackTypes:Fe}=i.findByProps("triggerHapticFeedback"),D=t.stylesheet.createThemedStyleSheet({container:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:A.semanticColors.BACKGROUND_FLOATING,width:72,height:72,borderRadius:4},inner:{display:"flex",justifyContent:"space-evenly",alignItems:"center"},selected:{borderWidth:2,borderColor:A.semanticColors.BUTTON_OUTLINE_BRAND_BORDER_ACTIVE},disabled:{opacity:.5}}),j=function(e){Ue(Fe.IMPACT_LIGHT),e()};function V(e){let{onPress:a=void 0,onLongPress:n=void 0,disabled:r=void 0,lookDisabled:o=void 0,selected:l=!1,children:s}=e;return React.createElement(Be,{onPress:a?function(){return j(a)}:void 0,onLongPress:n?function(){return j(n)}:void 0,disabled:r},React.createElement(H,{style:[D.container,l?D.selected:null]},React.createElement(H,{style:[D.inner,(r||o)&&D.disabled]},s)))}const{TextStyleSheet:Le,Text:_e}=i.findByProps("TextStyleSheet");function N(e){let{source:a,label:n,onPress:r,disabled:o,selected:l=!1}=e;return React.createElement(V,{onPress:r,disabled:o,selected:l},React.createElement(y,{source:a}),React.createElement(_e,{style:[Le["text-sm/medium"]]},n))}const xe=i.findByProps("getAvatarDecorationURL","default"),{showSimpleActionSheet:Oe}=i.findByProps("showSimpleActionSheet"),{hideActionSheet:ke}=i.findByProps("openLazy","hideActionSheet"),Me=i.findByStoreName("UserStore"),{Image:ze}=t.ReactNative;function He(e){return Oe({key:"DecorationActionSheet",header:{title:e.alt??"Decoration",icon:React.createElement(ze,{source:{uri:xe.getAvatarDecorationURL({avatarDecoration:E(e)})},style:{width:24,height:24,marginRight:8}}),onClose:function(){return ke()}},options:[...e.authorId===Me.getCurrentUser().id?[{icon:d.getAssetIDByName("ic_message_delete"),label:"Delete",isDestructive:!0,onPress:function(){return U.showConfirmationAlert({title:"Delete Decoration",content:`Are you sure you want to delete ${e.alt??"this decoration"}?`,confirmText:"Delete",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){return t.ReactNative.unstable_batchedUpdates(function(){return p.getState().delete(e)})}})}}]:[]]})}const je=i.findByName("CutoutableAvatarDecoration");function G(e){let{decoration:a,onPress:n=void 0,selectable:r=void 0,disabled:o=void 0}=e;const{selectedDecoration:l,select:s}=p(function(u){return{selectedDecoration:u.selectedDecoration,select:u.select}});return r??=a.reviewed===null||a.reviewed===!0,n??=function(){return s(a)},React.createElement(V,{onPress:r?n:void 0,onLongPress:function(){return He(a)},selected:l?.hash===a.hash,disabled:o,lookDisabled:!r},React.createElement(je,{avatarDecoration:E(a),size:56,animate:!1}))}const{FormTitle:Ve}=f.Forms,{View:P,FlatList:Ge}=t.ReactNative,{TextStyleSheet:We,Text:Ke}=i.findByProps("TextStyleSheet");function Ye(e){let{preset:a}=e;const n=p(function(o){return o.select}),r=t.NavigationNative.useNavigation();return React.createElement(P,null,React.createElement(P,null,React.createElement(Ve,{title:a.name}),a.description&&React.createElement(Ke,{style:[We["text-sm/medium"],{paddingHorizontal:16,paddingBottom:8}]},a.description)),React.createElement(Ge,{horizontal:!0,showsHorizontalScrollIndicator:!1,data:a.decorations,renderItem:function(o){let{item:l}=o;return React.createElement(G,{decoration:l,onPress:function(){n(l),r.pop()}})},ItemSeparatorComponent:function(){return React.createElement(P,{style:{width:4}})},snapToInterval:74,decelerationRate:"fast",contentContainerStyle:{paddingHorizontal:8}}))}const{FlatList:qe}=t.ReactNative;function Xe(){const[e,a]=t.React.useState([]);return t.React.useEffect(function(){ae().then(function(n){return a(n)})},[]),t.React.createElement(qe,{data:e,renderItem:function(n){let{item:r}=n;return t.React.createElement(Ye,{preset:r})}})}const{FlatList:Je,View:$,ActivityIndicator:Qe}=t.ReactNative,{FormTitle:Ze}=f.Forms;function et(){const[e,a]=t.React.useState(!1),{decorations:n,selectedDecoration:r,fetch:o,clear:l,select:s}=p(),u=z();t.React.useEffect(function(){u?(o().then(function(){return a(!1)}).catch(function(K){return a(null)}),a(!0)):(l(),a(!1))},[u]);const yt=t.NavigationNative.useNavigation();return t.React.createElement(t.React.Fragment,null,t.React.createElement(k,{decorationData:r?E(r):null}),t.React.createElement(Ze,{title:"Decorations",icon:e?t.React.createElement(Qe,null):e===null?t.React.createElement(y,{source:d.getAssetIDByName("ic_warning_24px")}):void 0}),t.React.createElement(Je,{horizontal:!0,showsHorizontalScrollIndicator:!1,data:n,renderItem:function(K){let{item:gt}=K;return t.React.createElement(G,{decoration:gt,disabled:!u||e===null})},snapToInterval:74,decelerationRate:"fast",ItemSeparatorComponent:function(){return t.React.createElement($,{style:{width:4}})},ListHeaderComponent:function(){return t.React.createElement(N,{source:d.getAssetIDByName("img_none"),label:"None",onPress:function(){s(null)},disabled:!u||e===null,selected:!r})},ListHeaderComponentStyle:{paddingRight:n.length===0?2:4},ListFooterComponent:function(){return t.React.createElement($,{style:{flexDirection:"row"}},t.React.createElement(N,{source:d.getAssetIDByName("smile"),label:"Presets",onPress:function(){yt.push("VendettaCustomPage",{title:"Presets",render:Xe})},selected:r&&r.presetId!==null,disabled:!u||e===null}),t.React.createElement($,{style:{width:4}}),t.React.createElement(N,{source:d.getAssetIDByName("ic_add_24px"),label:"New..",onPress:Te,disabled:!u||e===null}))},ListFooterComponentStyle:{paddingLeft:n.length===0?2:4},contentContainerStyle:{paddingHorizontal:8}}))}const{Messages:R}=i.findByProps("Messages"),{triggerHapticFeedback:tt,HapticFeedbackTypes:at}=i.findByProps("triggerHapticFeedback"),{ScrollView:Rt,View:W}=t.ReactNative,{FormSection:I,FormRow:T,FormArrow:nt,FormSwitchRow:rt,FormCTAButton:it,FormDivider:ot,FormInput:st}=f.Forms,ct=f.HelpMessage,{KeyboardAwareScrollView:lt}=i.findByProps("KeyboardAwareScrollView");function ut(){F.useProxy(c.storage);const e=z();return t.React.createElement(lt,null,!e&&t.React.createElement(W,{style:{padding:8}},t.React.createElement(ct,{messageType:0},"You need to Authorize with Decor before you can get custom decorations.")),t.React.createElement(et,null),!e&&t.React.createElement(I,null,t.React.createElement(T,{label:"Authorize with Decor",leading:t.React.createElement(y,{source:d.getAssetIDByName("ic_link_24px")}),trailing:nt,onPress:ie})),t.React.createElement(I,null,t.React.createElement(T,{label:"Discord Server",leading:t.React.createElement(y,{source:d.getAssetIDByName("Discord")}),trailing:T.Arrow,onPress:function(){return t.url.openDeeplink(J)},onLongPress:function(){tt(at.IMPACT_LIGHT),c.storage.developerMode=!c.storage.developerMode}})),e&&t.React.createElement(it,{color:"danger",label:R.LOGOUT,onPress:function(){return U.showConfirmationAlert({title:R.LOGOUT,content:R.USER_SETTINGS_CONFIRM_LOGOUT,confirmText:R.LOGOUT,confirmColor:"red",cancelText:R.CANCEL,onConfirm:function(){return c.storage.token=void 0}})}}),c.storage.developerMode&&t.React.createElement(I,{title:"Developer Settings"},t.React.createElement(rt,{label:"Use Custom Constants",subLabel:"Override constants with custom values.",leading:t.React.createElement(y,{source:d.getAssetIDByName("ic_link_24px")}),value:c.storage.useCustomConstants,onValueChange:function(a){return c.storage.useCustomConstants=a}}),[{title:"Client ID",placeholder:"012345678910",key:"clientId"},{title:"Base URL",placeholder:"http://example.com",key:"baseUrl"},{title:"CDN URL",placeholder:"http://example.com",key:"cdnUrl"}].map(function(a){let{title:n,placeholder:r,key:o}=a;return t.React.createElement(t.React.Fragment,null,t.React.createElement(ot,null),t.React.createElement(st,{title:n,placeholder:r,value:c.storage[o],onChange:function(l){return c.storage[o]=l},disabled:!c.storage.useCustomConstants}))})),t.React.createElement(W,{style:{height:40}}))}const dt=i.findByStoreName("UserStore"),ft=i.findByProps("getAvatarDecorationURL","default"),{CollectiblesExperiment:B}=i.findByProps("useCollectiblesExperiment"),ht=i.findByProps("isAnimatedAvatarDecoration");let g=[];var pt={onLoad:async function(){g.push(pe),g.push(b.after("getUser",dt,function(e,a){a&&!a.avatarDecoration?.startsWith("decor_")&&m?.has(a.id)&&(a.avatarDecoration=`decor_${m?.get(a.id)}`)})),g.push(b.after("getAvatarDecorationURL",ft,function(e,a){let[{avatarDecoration:n,canAnimate:r}]=e;if(n?.startsWith("decor")){const o=n.split("_").slice(1);return!r&&o[0]==="a"&&o.shift(),X+`/${o.join("_")}.png`}else if(n?.startsWith("file://"))return n})),g.push(b.after("isAnimatedAvatarDecoration",ht,function(e,a){let[n]=e;if(t.ReactNative.Platform.OS==="ios"&&n?.startsWith("file://"))return!0})),g.push(function(){const e=B.getCurrentConfig().canUseAvatarDecorations;return B.getCurrentConfig().canUseAvatarDecorations=!0,function(){return B.getCurrentConfig().canUseAvatarDecorations=e}}()),c.storage.developerMode??=!1,Q()},onUnload:function(){g.forEach(function(e){return e()})},settings:ut};return C.default=pt,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.plugin,vendetta.ui.alerts,vendetta.ui.assets,vendetta.ui.components,vendetta.ui,vendetta.storage);
